var Tc=Tc||{};Tc.$=jQuery.noConflict(false);(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this;initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}}(name,prop[name]):prop[name]}function Class(){if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class}})();Tc.Config={dependencyPath:{library:"/js/libraries/dynamic/",plugin:"/js/plugins/dynamic/",util:"/js/utils/dynamic/"}};(function($){"use strict";Tc.Application=Class.extend({init:function($ctx,config){this.config=$.extend(Tc.Config,config);this.$ctx=$ctx||$("body");this.modules=[];this.connectors={};this.wildcardComponents=[];this.sandbox=new Tc.Sandbox(this,this.config)},registerModules:function($ctx){var that=this,modules=[];$ctx=$ctx||this.$ctx;$ctx.find(".mod").each(function(){var $this=$(this);var classes=$this.attr("class").split(" ");if(classes.length>1){var modName,skins=[],connectors=[];for(var i=0,len=classes.length;i<len;i++){var part=$.trim(classes[i]);if(part.indexOf("mod")===0&&part.length>3){modName=part.substr(3)}else if(part.indexOf("skin")===0){skins.push(part.substr(4).replace(modName,""))}}if($this.attr("data-connectors")){connectors=$this.attr("data-connectors").split(",");for(var i=0,len=connectors.length;i<len;i++){var connector=$.trim(connectors[i]);if(connector){connectors[i]=connector}}}if(modName&&Tc.Module[modName]){modules.push(that.registerModule($this,modName,skins,connectors))}}});return modules},unregisterModules:function(modules){var connectors=this.connectors,wildcardComponents=this.wildcardComponents;modules=modules||this.modules;if(modules===this.modules){this.wildcardComponents=[];this.connectors=[];this.modules=[]}else{for(var i=0,len=modules.length;i<len;i++){var module=modules[i];var index;for(var connectorId in connectors){if(connectors.hasOwnProperty(connectorId)){connectors[connectorId].unregisterComponent(module)}}index=$.inArray(module,wildcardComponents);if(index>-1){delete wildcardComponents[index]}index=$.inArray(module,this.modules);if(index>-1){delete this.modules[index]}}}},start:function(modules){var wildcardComponents=this.wildcardComponents,connectors=this.connectors;modules=modules||this.modules;for(var i=0,len=modules.length;i<len;i++){modules[i].start()}for(var i=0,len=wildcardComponents.length;i<len;i++){var component=wildcardComponents[i];if($.inArray(component,modules)>-1){for(var connectorId in connectors){if(connectors.hasOwnProperty(connectorId)){component.attachConnector(connectors[connectorId]);connectors[connectorId].registerComponent(component,"*")}}}}},stop:function(modules){modules=modules||this.modules;for(var i=0,len=modules.length;i<len;i++){modules[i].stop()}},registerModule:function($node,modName,skins,connectors){var modules=this.modules;modName=modName||null;skins=skins||[];connectors=connectors||[];if(modName&&Tc.Module[modName]){var modId=modules.length;$node.data("id",modId);modules[modId]=new Tc.Module[modName]($node,this.sandbox,modId);for(var i=0,len=skins.length;i<len;i++){var skinName=skins[i];if(Tc.Module[modName][skinName]){modules[modId]=modules[modId].getDecoratedModule(modName,skinName)}}for(var i=0,len=connectors.length;i<len;i++){this.registerConnection(connectors[i],modules[modId])}return modules[modId]}return null},registerConnection:function(connector,component){var connectorType=connector.replace(/[0-9]+[a-zA-Z]*$/,""),connectorId=connector.replace(/[a-zA-Z]*$/,"").replace(/^[a-zA-Z]*/,""),connectorRole=connector.replace(/^[a-zA-Z]*[0-9]*/,"");if(connectorId){if(connectorId==="*"&&connectorRole==="*"){this.wildcardComponents.push(component)}else{var connectors=this.connectors;if(!connectors[connectorId]){if(connectorType===""){connectors[connectorId]=new Tc.Connector(connectorId)}else if(Tc.Connector[connectorType]){connectors[connectorId]=new Tc.Connector[connectorType](connectorId)}}if(connectors[connectorId]){component.attachConnector(connectors[connectorId]);connectors[connectorId].registerComponent(component,connectorRole)}}}},unregisterConnection:function(connectorId,component){var wildcardComponents=this.wildcardComponents,connectors=this.connectors,connector=connectors[connectorId];if(connector){connector.unregisterComponent(component);component.detachConnector(connector)}var index=$.inArray(component,wildcardComponents);if(index>-1){delete wildcardComponents[index]}}})})(Tc.$);(function($){"use strict";Tc.Sandbox=Class.extend({init:function(application,config){this.application=application;this.config=config;this.dependencies=[];this.afterBindingCallbacks=[];this.firstScript=$("script").get(0)},addModules:function($ctx){var modules=[],application=this.application;if($ctx){modules=application.registerModules($ctx);application.start(modules)}return modules},removeModules:function(modules){var application=this.application;if(modules){application.stop(modules);application.unregisterModules(modules)}},subscribe:function(connector,module){var application=this.application;if(module instanceof Tc.Module&&connector){connector=connector+"";application.registerConnection(connector,module)}},unsubscribe:function(connectorId,module){var application=this.application;if(module instanceof Tc.Module&&connectorId){connectorId=parseInt(connectorId);application.unregisterConnection(connectorId,module)}},getModuleById:function(id){var application=this.application;if(application.modules[id]!==undefined){return application.modules[id]}else{throw new Error("the module with the id "+id+" does not exist")}},getConfig:function(){return this.config},getConfigParam:function(name){var config=this.config;if(config.name!==undefined){return config.name}else{throw new Error("the config param "+name+" does not exist")}},loadDependency:function(dependency,type,callback,phase){var that=this;phase=phase||"none";type=type||"plugin";if(that.dependencies[dependency]&&that.dependencies[dependency].state==="requested"){that.dependencies[dependency].callbacks.push(function(){callback(phase)})}else if(that.dependencies[dependency]&&that.dependencies[dependency].state==="loaded"){callback(phase)}else{that.dependencies[dependency]={state:"requested",callbacks:[]};var path;switch(type){case"library":case"plugin":case"util":path=this.config.dependencyPath[type];break;case"url":path="";break;case"default":path="";break}var script=document.createElement("script"),firstScript=this.firstScript;script.src=path+dependency;script.onreadystatechange=script.onload=function(){var readyState=script.readyState;if(!readyState||readyState=="loaded"||readyState=="complete"){that.dependencies[dependency].state="loaded";callback(phase);var callbacks=that.dependencies[dependency].callbacks;for(var i=0,len=callbacks.length;i<len;i++){callbacks[i]()}script.onload=script.onreadystatechange=null}};firstScript.parentNode.insertBefore(script,firstScript)}},readyForAfterBinding:function(callback){var afterBindingCallbacks=this.afterBindingCallbacks;afterBindingCallbacks.push(callback);if(this.application.modules.length==afterBindingCallbacks.length){for(var i=0;i<afterBindingCallbacks.length;i++){afterBindingCallbacks[i]()}}}})})(Tc.$);(function($){"use strict";Tc.Module=Class.extend({init:function($ctx,sandbox,modId){this.$ctx=$ctx;this.modId=modId;this.connectors=[];this.dependencyCounter={beforeBinding:0,onBinding:1,afterBinding:1};this.sandbox=sandbox},start:function(){if(this.dependencies){this.dependencies()}this.initBeforeBinding()},stop:function(){var $ctx=this.$ctx;$("*",$ctx).unbind().removeData();$ctx.unbind().removeData()},initBeforeBinding:function(){var that=this;this.checkDependencies("beforeBinding",function(){if(that.beforeBinding){that.beforeBinding(function(){that.beforeBindingCallback()})}else{that.beforeBindingCallback()}})},beforeBindingCallback:function(){this.dependencyCounter.onBinding--;this.initOnBinding()},initOnBinding:function(){var that=this;this.checkDependencies("onBinding",function(){if(that.onBinding){that.onBinding()}that.dependencyCounter.afterBinding--;that.initAfterBinding()})},initAfterBinding:function(){var that=this;this.checkDependencies("afterBinding",function(){that.sandbox.readyForAfterBinding(function(){if(that.afterBinding){that.afterBinding()}})})},checkDependencies:function(phase,callback){if(this.dependencyCounter[phase]===0){callback()}},require:function(dependency,type,phase,executeCallback){type=type||"plugin";phase=phase||"onBinding";executeCallback=executeCallback===false?false:true;this.dependencyCounter[phase]++;var callback=$.proxy(function(){if(executeCallback){var that=this;this.dependencyCounter[phase]--;that["init"+Tc.Utils.String.capitalize(phase)]()}},this.sandbox.getModuleById(this.modId));this.sandbox.loadDependency(dependency,type,callback,phase)},fire:function(state,data,defaultAction){var that=this,connectors=this.connectors;data=data||{};state=Tc.Utils.String.capitalize(state);$.each(connectors,function(){var connector=this;var callback=function(){if(typeof defaultAction=="function"){defaultAction()}connector.notify(that,"after"+state,data)};if(connector.notify(that,"on"+state,data,callback)){callback()}});if(connectors.length<1){if(typeof defaultAction=="function"){defaultAction()}}},attachConnector:function(connector){this.connectors.push(connector)},detachConnector:function(connector){var connectors=this.connectors;for(var i=0,len=connectors.length;i<len;i++){if(connectors[i]===connector){delete connectors[i];connectors.splice(i,1);break}}},getDecoratedModule:function(module,skin){if(Tc.Module[module][skin]){var decorator=Tc.Module[module][skin];decorator.prototype=this;decorator.prototype.constructor=Tc.Module[module][skin];return new decorator(this)}return null}})})(Tc.$);(function($){"use strict";Tc.Connector=Class.extend({init:function(connectorId){this.connectorId=connectorId;this.components=[]},registerComponent:function(component,role){role=role||"standard";this.components.push({component:component,role:role})},unregisterComponent:function(component){var components=this.components;for(var i=0,len=components.length;i<len;i++){if(components[i]&&components[i].component===component){delete components[i]}}},notify:function(origin,state,data,callback){var proceed=true,components=this.components;for(var i=0,len=components.length;i<len;i++){var component=components[i].component;if(component&&component!==origin&&component[state]){if(component[state](data,callback)===false){proceed=false}}}return proceed}})})(Tc.$);Tc.Utils={};(function($){Tc.Utils.String={capitalize:function(str){return str.substr(0,1).toUpperCase().concat(str.substr(1))}}})(Tc.$);
